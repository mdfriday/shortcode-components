# 主题管理系统实现指南

## 使用场景

Obsidian 用户，用我们提供的组件编写自己的笔记。
可以应用不同的主题，并且还能即实预览笔记渲染的效果。

笔记样例：

```text
{{< button variant="primary" theme="tailwind" >}}
```

预览笔记渲染效果时，要生成一个完整的 HTML，需要获取当前主题所有的 CSS 内容。
需要根据组件的属性获取包含在所有 CSS 里的 classes 类名组合。 

所以我们的样式管理系统，需要提供生成所有CSS的功能。
我们的样式系统还需要提供一个方法，让前端组件动态获取相应的classes。

这样，我们就可以支持正常预览了。

## 功能需求

- 实现语言：typescript
- 主题注册：可以注册多个主题
- 主题模式：所有主题支持两种模式，分别是 light 和 dark
- 主题模块：每个主题里除了基本样式外，还包含模块样式，如 button, card
- 主题拓展：可以基于一个主题进行一些修改，变成另一个主题，如基于 base, 拓展成 light, dark
- 模块classes：在前端解析完模块后，会生成原生 HTML， 在构建的过程中，前端需要主题系统提供当前属性配置的所有 classes名
- 模块变体：同一模块有多种变体，用户可以用主题加谈何的 classes 组合，显示不同风格的组件
- 主题CSS：为了实时预览，并且能切换主题，当生成预览页时，要获取当前主题的所有 CSS 内容。
- 主题样式CSS可以加前缀：因为在 Obsidian 中使用时，为了避免影响其它组件，需要样式隔离
- 主题系统提供预加载功能，可以加载本地 JSON 格式的主题所有信息。

## 模块定义

- 模式：配色方案。就是对同一套组件
- 主题：通过模块化定义，并可生成 CSS 集合，不仅包含基础样式，还包含使用基础样式组合的组件样式
- 组件：可以重用的HTML对象

## 实现细节

### 组件：

首先定义组件通用接口，以描述组件的行为。如生成组件所有的 CSS 。
还需要为主题定义主题的主件接口，可以通过主题获取指定组件的所有样式，这样主题在生成所有样式的时候，包含了所有组件的样式。
同时，每个主题需要实现的所有组件，如 button, card, 等等。
为了提高效率，组件是可以继承的。可以实现一套基础组件，所有主题可以选择是否继承这套基础组件库，并可以针对具体组件进行拓展。


## 具体实现步骤

1. 定义Theme, ThemeManager, Component 等类型接口
2. 创建主题 JSON 样例，包含基础元素如： colors， spacing， typography， fontSize， fontWeight， 还包含组件样式，组件支持各种变种样式
3. 创建 ThemeManager 实例，并设置好前缀 
   1. 预加载本地 JSON 主题
4. 创建样式服务
   1. 支持根据当前主题，通过传入组件相关属性，获取组件所有类名 classes
   2. 支持获取当前主题，所有 CSS 样式